/* -*-c++-*- */

/*

    Sartorial Programming Interface (SPI) code generators
    Copyright (C) 2012-2023 Sartorial Programming Ltd.

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.

*/
/**
 * defines Constant and various sub-classes
 */

%module constant;

/**
 * Interface class defining a constant scalar value.
 */
struct virtual Constant noId=True
{
    /** returns the data type name for the scalar */
    virtual string typeName() const;

    /** returns the string which should appear in documentation */
    virtual string docString() const;

    /** returns the integer value (where applicable) for the scalar */
    virtual int getInt() const
    {
        throw spi::RuntimeError("%s is not int",
                                self->typeName().c_str());
    }

    /** returns the date value (where applicable) for the scalar */
    virtual date getDate() const
    {
        throw spi::RuntimeError("%s is not date",
                                self->typeName().c_str());
    }

    /** returns the date time value (where applicable) for the scalar */
    virtual datetime getDateTime() const
    {
        throw spi::RuntimeError("%s is not datetime",
                                self->typeName().c_str());
    }

    /** returns the double value (where applicable) for the scalar */
    virtual double getDouble() const
    {
        throw spi::RuntimeError("%s is not double",
                                self->typeName().c_str());
    }

    /** returns the char value (where applicable) for the scalar */
    virtual char getChar() const
    {
        throw spi::RuntimeError("%s is not char",
                                self->typeName().c_str());
    }

    /** returns the string value (where applicable) for the scalar */
    virtual string getString() const
    {
        throw spi::RuntimeError("%s is not a string",
                                self->typeName().c_str());
    }

    /** returns the bool value (where applicable) for the scalar */
    virtual bool getBool() const
    {
        throw spi::RuntimeError("%s is not a bool",
                                self->typeName().c_str());
    }
};

/**
 * Integer constant defined in the configuration file.
 */
struct IntConstant : Constant
{
    /** integer value */
    int value;

    /** returns the string which should appear in documentation */
    extern string docString() const
    {
        return spi::StringFormat("%d", self->value);
    }

    /** returns "int" */
    extern string typeName() const
    {
        return "int";
    }

    /** returns the integer value for the scalar */
    extern int getInt() const
    {
        return self->value;
    }

    /** returns the double value for the scalar */
    extern double getDouble() const
    {
        return self->value;
    }
};

/**
 * Date constant defined in the configuration file.
 */
struct DateConstant : Constant
{
    /** date value */
    date value;

    /** returns the string which should appear in documentation */
    extern string docString() const
    {
        if ((int)(self->value) <= 0)
            return std::string();
        return std::string(self->value);
    }

    /** returns "date" */
    extern string typeName() const
    {
        return "date";
    }

    /** returns the date value for the scalar */
    extern date getDate() const
    {
        return self->value;
    }
};

/**
 * DateTime constant defined in the configuration file.
 */
struct DateTimeConstant : Constant
{
    /** datetime value */
    datetime value;

    /** returns the string which should appear in documentation */
    extern string docString() const
    {
        return self->value.ToString();
    }

    /** returns "datetime" */
    extern string typeName() const
    {
        return "datetime";
    }

    /** returns the date value for the scalar */
    extern datetime getDateTime() const
    {
        return self->value;
    }
};

/**
 * Double constant defined in the configuration file.
 */
struct DoubleConstant : Constant
{
    /** double value */
    double value;

    /** returns the string which should appear in documentation */
    extern string docString() const
    {
        return spi::StringFormat("%.15g", self->value);
    }

    /** returns "double" */
    extern string typeName() const
    {
        return "double";
    }

    /** returns the double value for the scalar */
    extern double getDouble() const
    {
        return self->value;
    }
};

/**
 * Character constant defined in the configuration file.
 */
struct CharConstant : Constant
{
    /** char value */
    char value;

    /** returns the string which should appear in documentation */
    extern string docString() const
    {
        return spi::StringFormat("'%c'", self->value);
    }

    /** returns "char" */
    extern string typeName() const
    {
        return "char";
    }

    /** returns the char value for the scalar */
    extern char getChar() const
    {
        return self->value;
    }
};

/**
 * String constant defined in the configuration file.
 */
struct StringConstant : Constant
{
    /** string value */
    string value;

    /** returns the string which should appear in documentation */
    extern string docString() const
    {
        return spi::StringFormat("\"%s\"", self->value.c_str());
    }

    /** returns "string" */
    extern string typeName() const
    {
        return "string";
    }

    /** returns the string value for the scalar */
    extern string getString() const
    {
        return self->value;
    }
};

/**
 * Bool constant defined in the configuration file.
 */
struct BoolConstant : Constant
{
    /** bool value */
    bool value;

    /** returns the string which should appear in documentation */
    extern string docString() const
    {
        return self->value ? "True" : "False";
    }

    /** returns "bool" */
    extern string typeName() const
    {
        return "bool";
    }

    /** returns the bool value for the scalar */
    extern bool getBool() const
    {
        return self->value;
    }
};

struct UndefinedConstant : Constant
{
    /** returns the data type name for the scalar */
    extern string typeName() const
    {
        return std::string();
    }

    /** returns the string which should appear in documentation */
    extern string docString() const
    {
        return std::string();
    }

    /** returns the integer value (where applicable) for the scalar */
    extern int getInt() const
    {
        return 0;
    }

    /** returns the date value (where applicable) for the scalar */
    extern date getDate() const
    {
        return spi::Date();
    }

    /** returns the date value (where applicable) for the scalar */
    extern datetime getDateTime() const
    {
        return spi::DateTime();
    }

    /** returns the double value (where applicable) for the scalar */
    extern double getDouble() const
    {
        return 0.0;
    }

    /** returns the char value (where applicable) for the scalar */
    extern char getChar() const
    {
        throw spi::RuntimeError("Undefined char not supported");
    }

    /** returns the string value (where applicable) for the scalar */
    extern string getString() const
    {
        return std::string();
    }

    /** returns the bool value (where applicable) for the scalar */
    extern bool getBool() const
    {
        return false;
    }
};
